# 토이프로젝트에 헥사고날을 적용해보았다

근래 진행한 Dokbaro 서비스에서 백엔드 아키텍처를 헥사고날을 기반으로 설계하였습니다.   
헥사고날 아키텍처를 선택한 배경은 무엇이고, 어떠한 점을 느꼈는지 지금부터 알아보도록 하겠습니다.  

# DOKBARO란??
자기계발과 성장을 위해 독서와 스터디를 활용하는 **개발자들을 위한 퀴즈 학습 플랫폼, DOKBARO**입니다.

개발 서적을 즐겨 읽지만, **매번 내용을 제대로 이해했는지 확인하기 어렵지 않으셨나요?** 혹은 이해 부족으로 인해 **독서 스터디가 소수만 적극적으로 참여하는 형태로 변질되는 경험**을 하셨을지도 모릅니다.

**TEAM DOKBARO**는 이러한 문제의 핵심이 **도서 이해도 부족**에 있다고 보았습니다.

그래서, **DOKBARO는**

📚 **퀴즈 출제 및 풀이 기능**으로 도서 내용을 재미있고 효과적으로 이해하도록 도와드려요.

💡 **스터디 리포트 기능**으로 스터디원들이 책에 대해 자유롭게 의견을 나누고, 서로의 학습 현황을 확인할 수 있어요.

**DOKBARO와 함께라면** 도서 이해도를 높이고, 스터디 활동을 보다 풍성하고 활발하게 만들어 이상적인 독서 환경을 경험하실 수 있습니다. ✌️

현재는 알파테스트 중에 있으니, 조금만 더 보완해서 여러분들께 선사하도록 하겠습니다!

# 레이어드 아키텍처의 역린(逆鱗)

레이어드 아키텍처의 가장 큰 문제는 도메인이 인프라에 종속된다는 점입니다.   
통상적으로 우리가 객체를 설계할 떄 행위를 기반으로 설계를 하고, 행위를 기반으로하는 상태를 결정하는 것이 일반적이라 생각합니다.

> 객체가 적합한지를 결정하는 것은 상태가 아니라 행동이다. 행동이 상태를 결정한다.  
> _객체지향 사실과 오해 - 조영호 -_

허나, DB는 상태(데이터) 만 저장하지 메서드(행위)를 저장하지 않습니다. 객체와 데이터가 바라보는 관점이 다른데, 이 둘을 통합할 수 있을까요?  
객체의 변경 주기를 DB가 따라갈 수 있을까요?  

물론 JPA와같은 ORM을 이용해서 이러한 간극을 줄일 수 있습니다. 허나, ORM을 통해서 객체를 원하는대로 설계할 수 있을까요?  
JPA가 많은 API를 제공한다 하지만, 일부 케이스에서 표현을 못하는 부분은 분명 존재합니다.

객체와 데이터의 간극을 어떻게 대응할 수 있을까요?  
이러한 질문에서 나온 해결책 중 하나가 헥사고날 아키텍처입니다.

# 헥사고날 아키텍처란?
헥사고날 아키텍처는 시스템 내부 로직과 외부 로직을 분리하여 변경에 유연한 아키텍처입니다.  
내부 로직에 대해 접근할 수 있는 부분을 인터페이스로 표현하고 (포트)  
외부에서 통신하는 시스템을 (어댑터) 포트와 연결하여 사용하는 구조입니다.  
그렇기 때문에 포트-어댑터 아키텍처라고도 합니다 (개인적으로 이 네이밍이 헥사고날보다 더 와닿네요)  
인터페이스로 외부와 격리를 했기에 Core 내부에서는 순수한 도메인 로직을 가질 수 있게 됩니다.

위 설명드린 아키텍처를 기반으로 DOKBARO는 다음과 같이 애플리케이션을 구성하였습니다.  
![img.png](img.png)

# 장점
헥사고날을 기반으로 개발하였을 때 느꼈던 장점을 설명드리겠습니다.

## 1. 표현의 자유를 쟁취했다.

## 2. 유닛 테스트가 너무 쉬웠어요

## 3. 인프라가 변경되어도 도메인은 알 바가 아니야

## 4. 변경 전파가 적으니 리펙터링이 쉬워요!

# 단점
장점만 있었으면 세상 모든 애플리케이션이 헥사고날을 기반으로 설계되었을겁니다.  
그럼 어떤 단점을 느꼈는지 나열하겠습니다.  

## 1. 복잡하다... 내 마음도 복잡해진다

## 2. 어댑터가 보통 하나만 있는데? 그러면 레이어드랑 다를것이 뭐야?

# 총평

솔직한 생각으로는 도메인 로직이 단순할 수록 생각보다 비효율적이다.
단순한 CRUD여도 수많은 클래스들을 생성하는 것을 보고 효율적이지 못하다는 판단을 했다.
허나 복잡한 로직일수록 얻는 이점은 극대화 된다. 인프라에 대해 신경쓰지 않고 순수한 객체만으로 로직을 작성하니 구현 측면해서는 훨씬 용이했다.
하지만 이 부분도 레이어드여서도 추상화만 잘 관리하면 충분히 도메인 격리가 가능하다 생각했다.

그럼 언제 헥사고날이 용이할까?
개인적인 생각으로는 input/output adapter가 변경이 많은 케이스에서 헥사고날의 이점을 극대화할 수 있을 것 같다
또한, 굳이 모든 도메인에 같은 아키텍처를 가져갈 필요도 없는 것 같다. 각 도메인에 맞게 적절한 아키텍처를 사용하여 구조화하는 것이 맞다 판단된다.

# 결론
내가 이 프로젝트에서 헥사고날을 적용한 것은 양날의 검이라 생각한다. 통일성이랍시고 모든 도메인에 헥사고날을 적용한게 도리어 개발에 대한 복잡도만 높인것이 아닐까 싶다.  
허나 이점을 취한 부분도 분명히 존재한다. 다음에 개발을 임할때는 도메인 별로 이점을 극대화하는 방향으로 유연한 설계를 가져가지 않을까 싶다.

틀을 맞춰 개발한다기 보다는 구현을 하면서 점진적으로 설계해나가 아키텍처를 확장해도 좋은 방식인 것 같다.

은총알은 없다. 허나, 최선은 있다. 도메인 복잡도, 개발 팀 전략에 따라 아키텍처도 유연하게 가져가야한다 생각한다.
